<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css" />
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <button id="load-tweets-btn">Load latest Tweets</button>
    <div id="tweet-container"></div>
    <script>

      $(document).ready(function(){
        var $tweetContainer = $('#tweet-container');

        var index = 0
        var tweetsLength = streams.home.length;
        var currentUser = null;
        var userIndex = 0;


       

        //populate first 10 tweets
        var getTweets = function() {
          while(index < streams.home.length){
          var tweet = streams.home[index];
          var $tweet = $('<div></div>');
   
          $tweet.html("<a class='username' username='" + tweet.user + "' href='#'>@" + tweet.user + "</a>: "
            + "<div class='tweet-message'>" + tweet.message + '</div>' 
             + "<div class='tweet-date'>" + jQuery.timeago(tweet.created_at) + "</div>");
          $tweet.prependTo($tweetContainer);
          index += 1;
          }
        }

        //first pull of tweets
        getTweets();

        //wait for button until new tweets ready
        setTimeout(function() {
          $('#load-tweets-btn').fadeIn();
        }, 1500);

        //prepend latest tweets
        $('#load-tweets-btn').on('click', function(e) {
          e.preventDefault();
          if (currentUser === null) {
            getTweets();
          } else {
            showUserTweets(currentUser, false);
          }
          
          
        })




        var showUserTweets = function(username, first) {
          if (first) {$tweetContainer.html('');}
          var userTweets = streams.users[username]
          while (userIndex < userTweets.length) {
            var tweet = userTweets[userIndex];
            var $tweet = $('<div></div>');
            $tweet.html("<a class='username' username='" + tweet.user + "' href='#'>@" + tweet.user + "</a>: "
            + "<div class='tweet-message'>" + tweet.message + '</div>' 
             + "<div class='tweet-date'>" + jQuery.timeago(tweet.created_at) + "</div>");
            $tweet.prependTo($tweetContainer);
            userIndex += 1;
          }
        }

        //show user stream on clicking name 
        $('#tweet-container').on('click', '.username', function(e) {
          e.preventDefault();
          var username = $(this).attr('username');
          currentUser = username;
          userIndex = 0;
          showUserTweets(username, true);
        });


      });

    </script>
  </body>
</html>
